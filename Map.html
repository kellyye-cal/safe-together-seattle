<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <script src="./index.js"></script>



    <style>/* Always set the map height explicitly to define the size of the div
        * element that contains the map. */
        #map {
        height: 300px;
        top: 50px;
        left: 50px;
        right: 50px;
        }
        
        /* Optional: Makes the sample page fill the window. */
        html,
        body {
        height: 80%;
        margin: 0;
        padding: 0;
        }
 </style>
  </head>


  <body>

    <div id="style-selector-control" class="map-control">
      <input
        type="radio"
        name="show-hide"
        id="hide-poi"
        class="selector-control"
      />
      <label for="hide-poi">Hide</label>
      <input
        type="radio"
        name="show-hide"
        id="show-poi"
        class="selector-control"
        checked="checked"
      />
      <label for="show-poi">Show</label>
    </div>
    
    <div id="map"></div>

    
    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script>
        let map;
        let markers = [];



        //Find the Location
        function initMap() {
          gMap = new google.maps.Map(document.getElementById("map"),  {
          mapTypeControl: false,
          });

          var initialLocation;
         


          //source: https://stackoverflow.com/questions/17382128/google-maps-api-center-map-on-clients-current-location
          navigator.geolocation.getCurrentPosition(function(position) {
          // Center on user's current location if geolocation prompt allowed
              initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
              gMap.setCenter(initialLocation);
              gMap.setZoom(17);
          }, function(positionError) {
              // User denied geolocation prompt - default to Seattle
              gMap.setCenter(new google.maps.LatLng(47.6062, -122.3321));
              gMap.setZoom(20);
          });





          //Hiding / Showing Markers    
          // Add controls to the map, allowing users to hide/show features.
          const styleControl = document.getElementById("style-selector-control");


                  //Create Marker
                  function createMarker(place) {
                    if (!place.geometry || !place.geometry.location) return;

                    const marker = new google.maps.Marker({
                      gMap,
                      position: place.geometry.location,
                    });
                    markers.push(marker);
                  }

                  //Set all markers to the map
                  function setMapOnAll(map) {
                    for (let i = 0; i < markers.length; i++) {
                      markers[i].setMap(map);
                    }
                  }

                  function hideMarkers() {
                    setMapOnAll(null);
                  }


                  function showMarkers() {
                    setMapOnAll(gMap);
                  }

                   function deleteMarkers() {
                     setMapOnAll(null);
                  }

          gMap.controls[google.maps.ControlPosition.TOP_LEFT].push(styleControl);
          // Apply new JSON when the user chooses to hide/show features.
          document.getElementById("hide-poi").addEventListener("click", () => {
                  //gMap.setOptions({ styles: styles["hide"] });
                  //Nearby Search
                  var service;
                  var infowindow;

              
                  var request = {
                    location: initialLocation,
                    radius: '500',
                    //type: ['restaurant']
                    openNow: true
                  };


                  service = new google.maps.places.PlacesService(gMap);
                  service.nearbySearch(request, callback_Nearby);
              

                  ///Change it!!!!! !!!!!!
                  function callback_Nearby(results, status) {
                      if (status == google.maps.places.PlacesServiceStatus.OK) {
                        for (var i = 0; i < results.length; i++) {
                          createMarker(results[i]);
                        }
                      }
                      showMarkers();
                  }


          });
          document.getElementById("show-poi").addEventListener("click", () => {
            deleteMarkers();
            gMap.setOptions({ styles: styles["default"] });
          });


 

      }

      const styles = {
      default: [],
      hide: [
        {
          featureType: "poi.business",
          stylers: [{ visibility: "off" }],
        },
        {
          featureType: "transit",
          elementType: "labels.icon",
          stylers: [{ visibility: "off" }],
        },
      ],

}
        
 
  //Insert map
  </script>
  
    
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmXKPUoBisK-w6Ywi4N3le8fFJfrVwL9E&libraries=places&callback=initMap">
    //Load the library for Google Places & Intialize Map
    </script>

 



   <!-- 
    <script>
      //Request details of opening hours
      const request = {
        placeId: "INSERT_PLACE_ID_HERE",
        fields:["name", "opening_hours", "utc_offset_minutes"]
      };

      const service = new google.maps.places.PlacesService(gMap);
      service.getDetails(request, callback);

    </script>
     -->


  </body>
</html>
